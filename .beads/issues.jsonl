{"id":"stackdocs-0b5","title":"Scroll padding for agent bar","description":"[Migrated from ACTIVE.md #38]\n\nContent cannot scroll past agent bar at bottom.\n\n- Documents table and extracted data table cut off behind agent bar\n- Need scroll padding/margin so users can scroll content past the floating bar\n- Affects both documents list and document detail views\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:47.068792+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-1jc","title":"Agent bar visual styling exploration","description":"[Migrated from ACTIVE.md #34]\n\nBackdrop blur, enhanced shadows, animation refinements.\n\nCurrent: Basic bg-sidebar with shadow-md\nExplore: Backdrop blur effects, depth/layering, dark mode polish\nRelated: Agent bar redesign\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:39.498048+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-2km","title":"Agent bar max height and scroll behavior","description":"[Migrated from ACTIVE.md #35]\n\nDefine expanded height limits and scroll UX.\n\nDefine max expanded height before scrolling\nScroll behavior for long content (steps list, flow content)\nRelated: Agent bar redesign\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:40.952745+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-39p","title":"Inline stack creation during upload","description":"[Migrated from ACTIVE.md #12]\n\n\"+ New Stack\" chip in upload dialog to create stack without leaving flow.\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:07.264132+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-41u","title":"Drag-and-drop anywhere on documents page","description":"[Migrated from ACTIVE.md #11]\n\nDrop file anywhere to start upload, skip dialog step 1, jump straight to extraction config.\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:05.316195+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-42c","title":"TanStack Query for instant navigation","description":"[Migrated from ACTIVE.md #27]\n\nAdd client-side caching to eliminate loading screens on repeat visits.\n\nProblem: Server Components refetch on every navigation, causing skeleton flashes\nSolution: TanStack Query with staleTime for documents list, detail pages\nGoal: File browser feel - cached data shown instantly, background sync\nScope: Start with documents list, expand to stacks if successful\n\nDate: 2025-12-29","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:54.879335+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-4dj","title":"OS-aware keyboard shortcut display","description":"[Migrated from ACTIVE.md #31]\n\nCreate useModifierKey() hook to show Cmd on Mac, Ctrl on Windows/Linux in tooltips.\n\nCurrently: Tooltips hardcode Cmd symbol (e.g., \"Toggle sidebar (Cmd+B)\", \"Search (Cmd+K)\")\nGoal: Detect OS and show appropriate modifier key\nFiles: frontend/app/(app)/layout.tsx:53, frontend/components/layout/sidebar/sidebar-header-menu.tsx:116\n\nDate: 2025-12-31","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:33.776189+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-4pv","title":"Reusable EmptyState component","description":"[Migrated from ACTIVE.md #41]\n\nConsistent empty state UI across all pages.\n\nProps: icon, title, description, optional action button\nUse cases: no documents uploaded, no search results, no filters match, no stacks, preview panel (no doc selected)\nDesign: Simple illustration + text pattern, keep it lightweight\n\nDate: 2026-01-07","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:50.218523+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-4z3","title":"Stacks Feature","description":"Frontend stacks UI feature - pages and tables. Phases 1-2 complete (foundation, pages). Phase 3 partially complete (table view done, pending tasks deferred until Stack Agent built).","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:27.746807+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-4z3.1","title":"Add 'Not extracted' indicator for pending docs","description":"Show pending extraction indicator in StackTableView for documents not yet in stack_table_rows. Blocked until Stack Agent is built.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:23.225618+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-4z3.2","title":"Add CSV export functionality","description":"Create frontend/lib/export-csv.ts utility and wire up Export button in stack-detail-client.tsx. Blocked until Stack Agent populates data.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:24.679191+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-4z3.3","title":"Create stacks component barrel export","description":"Create frontend/components/stacks/index.ts with exports for StackDetailClient, StackDocumentsTab, StackTableView, createStackTableColumns.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:26.070896+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-5k1","title":"Create useLocalStorage hook","description":"[Migrated from ACTIVE.md #29 - was tech-debt]\n\nReusable hook for localStorage state with SSR handling.\n\nCurrently: Inline localStorage usage in preview-panel-context.tsx\nGoal: DRY pattern for persisting UI state (sidebar, panels, preferences)\nConsider: useSyncExternalStore for proper SSR support\n\nDate: 2025-12-29","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:58.055575+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-6e9","title":"Changed field highlight animation not visible","description":"[Migrated from ACTIVE.md #8]\n\nAnimation exists but too subtle or clearing too fast.\n\nFiles:\n- frontend/app/globals.css:130-142\n- frontend/components/documents/document-detail-client.tsx (changedFields state)\n- frontend/components/documents/extracted-data-table.tsx:97\n\nFix: Increase opacity (currently 15%), extend duration, or check if class is being applied.\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:02.224812+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-6x8","title":"Field type definitions for custom extraction","description":"[Migrated from ACTIVE.md #2]\n\nAdd type selector (text, number, date, array) to field badges, enforce type safety in agent output.\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:06:52.728008+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-73j","title":"Investigate Mistral OCR markdown output","description":"[Migrated from ACTIVE.md #7]\n\nCurrently exporting as raw text, check if API supports structured markdown output.\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:00.936626+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-7cw","title":"Realtime subscription breaks on document detail pages","description":"[Migrated from ACTIVE.md #25]\n\nChannel fails with \"CLOSED undefined\" after 1-2 minutes, likely Clerk JWT expiry not refreshing Supabase connection.\n\nError: [Realtime Debug] Channel failed: CLOSED undefined in useExtractionRealtime.useEffect\n\nFiles:\n- frontend/hooks/useExtractionRealtime.ts\n\nInvestigate: JWT token refresh, Supabase realtime auth, channel reconnection logic.\n\nDate: 2025-12-28","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:51.071101+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-7vb","title":"Documents Redesign","description":"Transform Documents section from file+extraction hybrid into pure file management. AI-generated metadata on upload, metadata review step, simplified document table.","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:16.524937+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-7vb.1","title":"Phase 1: Create database migration for metadata columns","description":"Add display_name, tags, summary, updated_at columns to documents table. Create migration file, apply via Supabase, verify trigger works.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:39.069143+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.10","title":"Phase 3: Add streamDocumentMetadata API helper","description":"Add SSE streaming function to frontend/lib/agent-api.ts for metadata generation endpoint.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:21.053622+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.11","title":"Phase 3: Create UploadProcessing step component","description":"Create upload-processing.tsx showing spinner and tool events during OCR + metadata generation.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:22.383628+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.12","title":"Phase 3: Create UploadMetadata step component","description":"Create upload-metadata.tsx with editable display name, tags, summary, optional stack picker, regenerate and save buttons.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:24.077493+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.13","title":"Phase 3: Update UploadComplete and flow metadata","description":"Update complete step messaging, update steps/index.ts exports, update metadata.ts flow config.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:25.749419+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.14","title":"Phase 3: Rewrite use-upload-flow hook","description":"Implement new flow: file select -\u003e upload -\u003e OCR -\u003e metadata generation -\u003e review -\u003e save. Handle regenerate and stack assignment.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:27.120824+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.15","title":"Phase 3: Delete old step components","description":"Delete upload-configure.tsx, upload-fields.tsx, upload-extracting.tsx, extraction-method-card.tsx, field-tag-input.tsx after verifying build.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:29.284491+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.16","title":"Phase 4: Delete /documents/[id] routes","description":"Remove document detail page routes if they exist (main, @header, @subbar).","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:46.405235+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.17","title":"Phase 4: Change document name from Link to span","description":"Update columns.tsx to remove Link navigation from document name cell.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:48.075016+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.18","title":"Phase 4: Update preview panel with new metadata display","description":"Add displayName, tags, summary to PreviewMetadata. Remove fieldCount. Show tags as badges, summary with tooltip.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:49.862677+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.19","title":"Phase 4: Update selected document context and data flow","description":"Add displayName, tags, summary to context. Update Document type. Update documents-table.tsx and layout.tsx.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:51.141593+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.2","title":"Phase 1: Update SCHEMA.md documentation","description":"Update docs/specs/SCHEMA.md with new columns, trigger function, and migration entry.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:40.661365+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.20","title":"Phase 4: Add selected document breadcrumb to header","description":"Extend PageHeader to show selected document name. Update @header/documents/page.tsx to display.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:52.632574+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.21","title":"Phase 4: Deprecate extract-document flow","description":"Remove from agent-actions.tsx, registry.ts, agent-store.ts. Add deprecation comments to flow files.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:54.352751+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.22","title":"Phase 4: Clean up deprecated components and queries","description":"Add deprecation comments to document detail components, getDocumentWithExtraction, streamAgentExtraction. Update CLAUDE.md.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:55.688625+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.23","title":"Phase 4: Verify build and manual testing","description":"Run npm run build, test all functionality in browser per manual testing checklist.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:56.948486+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.3","title":"Phase 2: Create document_processor_agent directory structure","description":"Create backend/app/agents/document_processor_agent/ with __init__.py, agent.py, prompts.py, and tools/ subdirectory.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:54.373887+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.4","title":"Phase 2: Create shared read_ocr tool (DRY)","description":"Extract read_ocr tool to backend/app/agents/shared/tools/ for reuse by extraction_agent and document_processor_agent.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:56.408671+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.5","title":"Phase 2: Create save_metadata tool","description":"Create save_metadata tool that writes display_name, tags, summary to documents table with validation.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:58.189322+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.6","title":"Phase 2: Create metadata system prompt","description":"Create METADATA_SYSTEM_PROMPT in prompts.py with guidelines for display_name, tags, and summary generation.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:59.708814+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.7","title":"Phase 2: Create process_document_metadata agent function","description":"Implement process_document_metadata() in agent.py with Claude Agent SDK streaming.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:01.336482+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.8","title":"Phase 2: Create POST /api/document/metadata endpoint","description":"Add SSE streaming endpoint to routes/document.py. Create shared sse_event utility in utils/sse.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:02.652837+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7vb.9","title":"Phase 3: Update agent store types for new upload flow","description":"Update UploadFlowStep and UploadFlowData types. Change steps to dropzone/processing/metadata/complete.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:29:18.972092+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Code review verified implementation complete (Phases 1-3 of Documents Redesign)","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-7zs","title":"Upload dialog UI/UX polish","description":"[Migrated from ACTIVE.md #21]\n\nRedesign wizard flow, integrate with AI chat bar for seamless upload-to-extraction experience.\n\nDate: 2025-12-28","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:49.381915+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-830","title":"Superpowers to Space-Agents Migration","status":"tombstone","priority":1,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:25.354634+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Migration complete: DEV-NOTES→CAPCOM, Issues→Beads, Features→Epics, CLAUDE.md updated, folders restructured, commands archived","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-830.1","title":"Transform DEV-NOTES to CAPCOM","description":"Convert 111 sessions from DEV-NOTES.md to CAPCOM format using Python script","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:36.841507+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"stackdocs-830.1","author":"thebrownproject","text":"[ATTEMPT] Starting implementation - attempt 1","created_at":"2026-01-24T22:56:40Z"},{"id":2,"issue_id":"stackdocs-830.1","author":"thebrownproject","text":"[HANDOVER] DEV-NOTES to CAPCOM migration script created\n\n## Summary\nCreated Python script to migrate 109 sessions from DEV-NOTES.md to CAPCOM format. Script handles both old format (Sessions 1-2) and new superpowers template format. Idempotent - can be re-run safely.\n\n## Files Changed\n- backend/scripts/migrate_devnotes_to_capcom.py (created)\n\n## Key Details\n- Usage: python backend/scripts/migrate_devnotes_to_capcom.py [--dry-run]\n- Parses session headers, extracts completed tasks, decisions, issues, next steps\n- CAPCOM entries use format: ## [YYYY-MM-DD] Session N: Title\n- Already migrated 108 sessions to .space-agents/comms/capcom.md\n\n## Notes\n- Session count is 109 (not 111 as originally estimated)\n- One duplicate Session 50 exists in DEV-NOTES (same date)\n- Consider adding explicit encoding='utf-8' to file operations for cross-platform consistency","created_at":"2026-01-24T23:05:15Z"}],"deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.10","title":"BLOCKER: Pod reported blocker","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:25:15.871147+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Stale blocker - task .3 already completed successfully","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-830.11","title":"BLOCKER: Pod reported blocker","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:35:26.571584+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Orphan blocker - no context, current pod run successful","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-830.2","title":"Migrate Issues to Beads","description":"Convert 31 issues from ACTIVE.md to Beads","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:36.947583+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"stackdocs-830.2","author":"thebrownproject","text":"[ATTEMPT] Starting implementation - attempt 1","created_at":"2026-01-24T23:06:08Z"},{"id":4,"issue_id":"stackdocs-830.2","author":"thebrownproject","text":"[HANDOVER] Migrated 31 issues from ACTIVE.md to Beads\n\n## Summary\nSuccessfully migrated all 31 issues from docs/plans/issues/ACTIVE.md to the Beads issue tracker. Original issue numbers are preserved in bead descriptions for traceability.\n\n## Files Changed\n- .beads/issues.jsonl (modified - 31 new issues added)\n- docs/plans/issues/ACTIVE.md (modified - marked as [ARCHIVED])\n\n## Key Details\n- Type mapping: bug -\u003e bug, feature -\u003e feature, tech-debt -\u003e task\n- All issues set to P2 priority\n- Each bead includes [Migrated from ACTIVE.md #XX] in description\n- Original ACTIVE.md preserved for historical reference with strikethrough on old workflow text\n\n## Notes\n- COMPLETED.md was not migrated (contains 9 resolved issues for historical reference)\n- The issue list in ACTIVE.md is still visible but marked archived - users should use bd commands going forward","created_at":"2026-01-24T23:12:14Z"}],"deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.3","title":"Update CLAUDE.md Files","description":"Update root and docs/ CLAUDE.md to reference Space-Agents workflow","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:37.05302+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Closed","comments":[{"id":5,"issue_id":"stackdocs-830.3","author":"thebrownproject","text":"[ATTEMPT] Starting implementation - attempt 1","created_at":"2026-01-24T23:16:39Z"},{"id":6,"issue_id":"stackdocs-830.3","author":"thebrownproject","text":"[HANDOVER] Updated CLAUDE.md files to Space-Agents workflow\n\n## Summary\nUpdated root CLAUDE.md and docs/CLAUDE.md to reference Space-Agents workflow instead of Superpowers. All skill references, session commands, and documentation paths migrated.\n\n## Files Changed\n- CLAUDE.md (modified)\n- docs/CLAUDE.md (modified)\n\n## Key Details\n- Workflow skills: /exploration, /exploration-plan, /mission\n- Session commands: /launch, /land, /capcom\n- Session history: .space-agents/comms/capcom.md (was DEV-NOTES.md)\n- Issue tracking: Beads bd commands (was ACTIVE.md)\n- Folder structure updated to show .space-agents/ and .beads/\n\n## Notes\n- Old files (DEV-NOTES.md, ACTIVE.md) still exist for reference but are no longer documented\n- Analyst noted cleanup task may be needed later to remove old files","created_at":"2026-01-24T23:19:55Z"}],"deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.4","title":"Migrate Features to Beads","description":"Convert 4 features from plans/ to Beads epics: documents-redesign, stacks, stack-agent, backend-hardening","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:43.161905+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Closed","comments":[{"id":7,"issue_id":"stackdocs-830.4","author":"thebrownproject","text":"[ATTEMPT] Starting implementation - attempt 1","created_at":"2026-01-24T23:27:00Z"},{"id":8,"issue_id":"stackdocs-830.4","author":"thebrownproject","text":"[HANDOVER] Migrated 4 feature plans to Beads epics with 48 child tasks\n\n## Summary\nSuccessfully migrated 4 feature plans from docs/plans/ to Beads issue tracker as epics. Created 48 child tasks across the epics with appropriate dependencies between phases.\n\n## Files Changed\n- CLAUDE.md (modified - workflow updated to Space-Agents)\n- docs/CLAUDE.md (modified - planning docs updated)\n- docs/plans/in-progress/documents-redesign/README.md (archived)\n- docs/plans/in-progress/stacks/2025-12-29-stacks-implementation-plan.md (archived)\n- docs/plans/issues/ACTIVE.md (archived notice added)\n- docs/plans/roadmap/IN-PROGRESS.md (status updated)\n- docs/plans/todo/backend-hardening/2025-12-23-backend-production-hardening.md (archived)\n- docs/plans/todo/stack-agent/04-backend-routes.md (archived)\n- docs/plans/todo/stack-agent/05-agent-tools.md (archived)\n\n## Key Details\n- Epic IDs: stackdocs-7vb (Documents Redesign, 23 tasks), stackdocs-4z3 (Stacks, 3 tasks), stackdocs-drg (Stack Agent, 8 tasks), stackdocs-e7z (Backend Hardening, 14 tasks)\n- Dependencies added: phase-based within epics, cross-epic (Stacks blocked by Stack Agent)\n- Archive format: [ARCHIVED] in title + migration notice pointing to bd show command\n\n## Notes\n- Original plan files preserved for detailed implementation notes\n- Analyst noted info-level issue: archived files still contain superpowers:executing-plans reference (acceptable for historical context)","created_at":"2026-01-24T23:37:16Z"}],"deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.5","title":"Restructure Folders","description":"Archive old docs/plans/ and docs/sessions/ to docs/archive/","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:53.80588+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Archived docs/plans/ and docs/sessions/ to docs/archive/, updated CLAUDE.md references","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.6","title":"Cleanup Commands","description":"Archive or delete old .claude/commands/ that are replaced by Space-Agents","status":"tombstone","priority":3,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:53.909913+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Archived 6 replaced commands to .claude/commands/archive/, kept code-review.md and debug.md","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-830.7","title":"Cleanup Superpowers References","description":"Remove stale superpowers references from 20+ archived plan files (low priority)","status":"tombstone","priority":3,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T09:37:54.012286+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","close_reason":"Updated code-review.md to remove superpowers prefix, verified no active CLAUDE.md files reference superpowers, left archives unchanged","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-8dl","title":"Undo/Redo navigation in sidebar header","description":"[Migrated from ACTIVE.md #18]\n\nLinear-style back/forward/history buttons above search, requires navigation history system.\n\nDate: 2025-12-25","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:46.600801+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-8pg","title":"Preview panel redesign","description":"[Migrated from ACTIVE.md #36]\n\nUI tweaks to right-side document preview.\n\n- PDF/Visual tab styling improvements\n- Document metadata section (filename, date, size, status)\n- Visual (OCR) view markdown rendering polish\n- Loading states when switching documents\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:42.347018+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-8tb","title":"Preview panel Open button","description":"[Migrated from ACTIVE.md #40]\n\nAdd button in preview panel header to navigate to document detail.\n\n- When document is previewed in sidebar, show \"Open\" or expand icon in preview panel header\n- Clicking navigates to /documents/[id] detail page\n- Pattern similar to Linear/Notion preview panels\n- Related: Preview panel redesign (#36)\n\nDate: 2026-01-04","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:48.347265+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-97i","title":"Persist selected document in Zustand","description":"[Migrated from ACTIVE.md #37]\n\nRemember last selected doc on page reload.\n\n- Add localStorage persistence to selected document state\n- Use Zustand persist middleware\n- Restore selection when navigating back to documents page\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:45.678181+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-ag6","title":"Review and trim protocol + Bridge bloat","description":"Inspector flagged Bridge src/ at ~910 lines vs ~300 target. protocol.ts alone is 448 lines. Investigate: excessive comments, over-engineered type guards, verbose patterns. Trim all three protocol files (bridge TS, frontend TS, sprite Python) in sync. Target: Bridge src/ closer to 300 lines excluding shared protocol. Run all tests after.","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T23:09:15.0507+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T23:09:15.0507+11:00"}
{"id":"stackdocs-cch","title":"Document status stuck at ocr_complete","description":"[Migrated from ACTIVE.md #16]\n\nExtraction agent saves data but doesn't call complete tool, so document/extraction status never updates to completed.\n\nFiles:\n- backend/app/agents/extraction_agent/agent.py\n- backend/app/agents/extraction_agent/tools/complete.py\n\nAgent needs to reliably call complete tool after saving extraction.\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:45.419036+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-cpy","title":"Evaluate column separation pattern for dynamic tables","description":"[Migrated from ACTIVE.md #26 - was tech-debt]\n\nStack tables use separated columns file (stack-table-columns.tsx) following documents pattern, but columns are dynamically generated from schema. Consider if inline definition would be simpler for this use case.\n\nCurrent: columns.tsx separate, documents-table.tsx imports it (static columns, 170 lines)\nStack tables: Dynamic createStackTableColumns(schema) function - tightly coupled anyway\nQuestion: Does separation still provide value for dynamic column generation?\n\nDate: 2025-12-29","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:53.260241+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg","title":"Stack Agent","description":"Backend stack extraction agent with SSE routes. Create FastAPI routes for stack agent operations (extract, correct) and Claude Agent SDK tools for reading documents and writing stack table rows.","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:29.682019+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-drg.1","title":"Create stack_agent directory structure","description":"Create backend/app/agents/stack_agent/ with __init__.py, agent.py, prompts.py, and tools/ subdirectory.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:48.653958+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.2","title":"Create stack agent prompts","description":"Write STACK_EXTRACTION_SYSTEM_PROMPT and task templates for auto/custom modes and correction workflow.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:49.916701+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.3","title":"Create stack agent read tools","description":"Implement read_document_extraction, read_ocr, read_rows tools in tools/read_tools.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:51.173611+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.4","title":"Create stack agent write tools","description":"Implement define_columns, save_row, update_row, complete tools in tools/write_tools.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:52.936255+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.5","title":"Create stack agent tool factory","description":"Implement create_extraction_tools and create_correction_tools in tools/__init__.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:54.304639+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.6","title":"Implement extract_stack_table and correct_stack_table","description":"Main agent functions in agent.py with Claude Agent SDK streaming.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:30:55.957614+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.7","title":"Create stack router with SSE endpoints","description":"Create backend/app/routes/stack.py with POST /api/stack/{stack_id}/tables/{table_id}/extract and /correct endpoints.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:03.262825+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-drg.8","title":"Register stack router in main.py","description":"Import and register stack_router with prefix /api/stack in backend/app/main.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:04.819038+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z","title":"Backend Production Hardening","description":"Harden FastAPI backend for production: security headers, CORS restrictions, rate limiting, file content validation, structured logging, global exception handling.","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:28:31.441145+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-e7z.1","title":"Phase 1: Add security headers middleware","description":"Create middleware/security.py with HSTS, X-Content-Type-Options, X-Frame-Options, X-XSS-Protection, Referrer-Policy, Permissions-Policy.","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:25.8324+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.10","title":"Phase 5: Enhance Pydantic settings validation","description":"Add field validators for CLAUDE_MODEL, ENVIRONMENT. Add min_length constraints to API keys.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:04.230035+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.11","title":"Phase 6: Enhance health check endpoint","description":"Add database connectivity check. Return 'degraded' status if checks fail. Include individual check results.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:09.945997+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.12","title":"Phase 7: Finalize middleware stack order","description":"Organize middleware in correct order: RequestID (outermost), CORS, SecurityHeaders, SlowAPI. Verify integration.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:18.381707+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.13","title":"Phase 7: Add graceful shutdown to Dockerfile","description":"Add --timeout-graceful-shutdown 30 to uvicorn CMD for in-flight request completion.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:19.797667+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.14","title":"Phase 7: Create PRODUCTION.md documentation","description":"Document security checklist, rate limits, environment variables, and deployment configuration.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:21.136839+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.2","title":"Phase 1: Restrict CORS configuration","description":"Update CORS middleware to explicit methods (GET, POST, PUT, DELETE, OPTIONS) and headers (Authorization, Content-Type, X-Request-ID).","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:27.89389+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.3","title":"Phase 2: Install slowapi and create rate limiter","description":"Add slowapi to requirements.txt. Create middleware/rate_limit.py with user/IP-based keys and 100/minute default.","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:35.0243+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.4","title":"Phase 2: Apply rate limits to routes","description":"Add rate decorators: upload 10/min, retry-ocr 5/min, extract 20/min, correct 30/min. Register in main.py.","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:37.393508+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.5","title":"Phase 3: Install python-magic and validate file content","description":"Add python-magic to requirements.txt, libmagic to Dockerfile. Update _validate_file to check actual MIME type from bytes.","status":"tombstone","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:43.391485+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.6","title":"Phase 4: Create global exception handlers","description":"Create middleware/exceptions.py with global, HTTP, and validation exception handlers. Hide internal details in production.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:52.250002+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.7","title":"Phase 4: Add request ID middleware","description":"Create middleware/request_id.py to generate/propagate X-Request-ID for tracing.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:53.671952+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.8","title":"Phase 4: Sanitize error messages in services","description":"Update storage.py and document.py to return generic error messages, log details internally.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:31:55.436419+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-e7z.9","title":"Phase 5: Add structured logging configuration","description":"Create logging_config.py with JSON formatter for production, readable format for development. Initialize in main.py.","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:32:02.531313+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-fg6","title":"Sidebar collapsible section state persistence","description":"[Migrated from ACTIVE.md #28]\n\nRemember open/closed state across page refreshes.\n\nChallenge: SSR hydration mismatch when reading localStorage on client\nOptions: Cookies (server-readable), localStorage with hydration workaround, or accept flash\nFiles: frontend/components/layout/sidebar/collapsible-section.tsx\n\nDate: 2025-12-29","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:56.473476+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-h3e","title":"Sub-bar button functionality","description":"[Migrated from ACTIVE.md #20]\n\nFilter dropdown options, Edit inline editing, Export format options need implementation.\n\nDate: 2025-12-28","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:48.116582+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-k8w","title":"Documents table accessibility improvements","description":"[Migrated from ACTIVE.md #5 - was tech-debt]\n\nAdd keyboard navigation (Enter/Space) and ARIA labels to clickable rows in documents table.\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:06:57.301429+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"stackdocs-lab","title":"Global context to persist SSE streams across navigation","description":"[Migrated from ACTIVE.md #10]\n\nCurrently if user navigates away mid-extraction/correction, progress panel is lost (agent continues server-side).\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:03.795937+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-lau","title":"AI prompt flow with auto-generated titles","description":"[Migrated from ACTIVE.md #33]\n\nNatural language input morphs to brief summary title, agent works on request.\n\nUser types prompt in agent bar -\u003e bar morphs to show AI-generated 3-5 word title\nAgent streams response in content area below\nSame unified card pattern as wizard flows\nRelated: Agent bar redesign (docs/plans/in-progress/agent-bar-redesign/)\n\nDate: 2026-01-01","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:37.67489+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-m7b","title":"Stackdocs v2 — Sovereign Agent Platform","description":"Rewrite Stackdocs from a multi-tenant SaaS into a personal AI computer where each stack runs on its own Sprite (microVM), connected via a Fly.io WebSocket Bridge, with a Canvas UI for visual output. 29 tasks across 6 phases. Spec: .space-agents/exploration/planned/2026-02-06-stackdocs-v2-revised-architecture/spec.md Plan: .space-agents/exploration/planned/2026-02-06-stackdocs-v2-revised-architecture/plan.md","status":"open","priority":0,"issue_type":"epic","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:16:58.403891+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:16:58.403891+11:00"}
{"id":"stackdocs-m7b.1","title":"Phase 0: Pre-flight Validation","description":"Mandatory gate before writing any code. Validates Sprites.dev and Fly.io viability.","status":"closed","priority":0,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:07.334352+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T17:06:24.838246+11:00","closed_at":"2026-02-06T17:06:24.838246+11:00","close_reason":"Phase 0 complete. Gate: PASS. Proceed to Phase 1.","dependencies":[{"issue_id":"stackdocs-m7b.1","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:07.335439+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.1.1","title":"Pre-flight validation (Fly.io + Sprites.dev)","description":"**Goal:** Validate Sprites.dev and Fly.io accounts, APIs, and critical assumptions before writing any code.\n**Files:** Create `docs/ops/preflight-results.md` (findings and measurements)\n**Depends on:** None\n\n**Steps:**\n1. Fly.io account setup + billing\n2. Sprites.dev account + API token\n3. Test Sprites APIs manually: create, exec, sleep, wake, services, TCP proxy\n4. **Verify Service auto-restart on wake** (MEDIUM confidence — the spec's biggest risk)\n5. Measure Sprites.dev region latency from Australia\n6. If auto-restart fails: document fallback (Bridge sends exec command after every wake)\n7. Write up findings in `docs/ops/preflight-results.md`\n\n**Tests:**\n- [ ] `docs/ops/preflight-results.md` exists with all 5 checks documented\n- [ ] Auto-restart result explicitly confirmed or denied with evidence\n- [ ] Latency measurement from Australia recorded (target \u003c 200ms)\n- [ ] If auto-restart failed: fallback documented and Bridge reconnection task updated\n\n**Gate:** All checks pass. If auto-restart fails, update Bridge reconnection task before proceeding.","status":"closed","priority":0,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:35.987205+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T17:06:24.712727+11:00","closed_at":"2026-02-06T17:06:24.712727+11:00","close_reason":"Pre-flight PASSED. All critical checks pass. Key finding: processes survive sleep/wake (CRIU/checkpoint), not killed as assumed. Services API has bug but is non-blocking. TCP Proxy works perfectly. AU latency avg 180ms (under 200ms target). See docs/ops/preflight-results.md","dependencies":[{"issue_id":"stackdocs-m7b.1.1","depends_on_id":"stackdocs-m7b.1","type":"parent-child","created_at":"2026-02-06T15:17:35.988156+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2","title":"Phase 1: Infrastructure Scaffold","description":"Build the message pipeline: Browser → Bridge → Sprite → Bridge → Browser. 8 tasks.","status":"in_progress","priority":0,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:10.256359+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T22:28:24.29574+11:00","dependencies":[{"issue_id":"stackdocs-m7b.2","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:10.257193+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.1","title":"Define WebSocket message protocol","description":"**Goal:** Establish the shared contract between Bridge, Sprite, and Frontend — all message types with TypeScript and Python definitions.\n**Files:** Create `bridge/src/protocol.ts`, create `frontend/types/ws-protocol.ts`, create `sprite/src/protocol.py`\n**Depends on:** None\n\n**Steps:**\n1. Define all message interfaces from spec: WebSocketMessage (base), MissionMessage, FileUploadMessage, CanvasInteraction, AuthConnect, AgentEvent, CanvasUpdate, StatusUpdate, SystemMessage\n2. Include mandatory `id` (UUID), `timestamp`, optional `request_id` on every message\n3. Define `Block` union type (8 MVP types): `heading`, `stat`, `key-value`, `table`, `badge`, `progress`, `text`, `separator` — each block has mandatory `id` and `type`\n4. `CanvasUpdate` uses card commands: `create_card`, `update_card`, `close_card` with `card_id` and `blocks: Block[]`\n5. `CanvasInteraction` uses `card_id` + optional `block_id` for targeted interactions\n6. TypeScript types in `bridge/src/protocol.ts` (source of truth)\n7. Copy types to `frontend/types/ws-protocol.ts`\n8. Python dataclasses in `sprite/src/protocol.py` matching the same schema\n9. Include message validation helpers (type guard functions)\n\n**Tests:**\n- [ ] `tsc --noEmit` passes for `bridge/src/protocol.ts` and `frontend/types/ws-protocol.ts`\n- [ ] `python -c \"from src.protocol import *\"` succeeds in `sprite/`\n- [ ] Type guard functions return `true` for valid messages, `false` for malformed\n- [ ] Every message type includes `id` (UUID) and `timestamp` fields\n- [ ] `Block` union covers all 8 MVP types with correct props\n- [ ] `CanvasUpdate` uses `create_card`/`update_card`/`close_card` commands with `blocks` array\n- [ ] TypeScript and Python definitions cover identical message types","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:18:46.853241+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T22:49:57.629751+11:00","closed_at":"2026-02-06T22:49:57.629751+11:00","close_reason":"Protocol types implemented: bridge/src/protocol.ts (TS source of truth), frontend/types/ws-protocol.ts (frontend copy), sprite/src/protocol.py (Python dataclasses). All 8 message types, 8 block types, mandatory id/timestamp, type guards. tsc and python imports pass.","dependencies":[{"issue_id":"stackdocs-m7b.2.1","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:18:46.854343+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.2","title":"Create Bridge project scaffold and WS server","description":"**Goal:** Fly.io Bridge service that accepts WebSocket connections from browsers with Clerk JWT auth.\n**Files:** Create `bridge/` directory: `package.json`, `tsconfig.json`, `Dockerfile`, `fly.toml`, `src/index.ts`, `src/auth.ts`\n**Depends on:** Define WebSocket message protocol\n\n**Steps:**\n1. Initialize `bridge/` with Node.js project: `ws`, `@clerk/backend`, `@supabase/supabase-js`, `uuid` deps\n2. Create HTTP server that upgrades to WebSocket on `/ws/{stack_id}`\n3. First message must be `type: 'auth'` with Clerk JWT — validate with `@clerk/backend` `verifyToken()`\n4. Extract `user_id` from JWT, associate with connection\n5. Invalid/missing token closes connection with code 4001\n6. Look up stack from Supabase `stacks` table, verify user_id owns it\n7. Store connection mapping: `Map\u003cconnectionId, { userId, stackId, spriteName }\u003e`\n8. Create Dockerfile and `fly.toml` for deployment (256MB RAM, shared CPU)\n\n**Tests:**\n- [ ] `npm test` passes in `bridge/`\n- [ ] WS client connects to `/ws/{stack_id}` and receives upgrade\n- [ ] Invalid JWT → connection closed with code 4001\n- [ ] Valid JWT → connection stored in map with correct userId/stackId\n- [ ] Unauthorized stack_id (wrong user) → connection closed with code 4003\n- [ ] `docker build` succeeds for Bridge Dockerfile","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:19:28.228352+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T23:00:24.268707+11:00","closed_at":"2026-02-06T23:00:24.268707+11:00","close_reason":"Bridge scaffold complete: HTTP server with WS upgrade on /ws/{stack_id}, Clerk JWT auth (4001/4003 codes), Supabase stack lookup, connection tracking map. 26/26 tests pass, tsc clean. Dockerfile + fly.toml for Fly.io deployment.","dependencies":[{"issue_id":"stackdocs-m7b.2.2","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:19:28.230592+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.2","depends_on_id":"stackdocs-m7b.1.1","type":"blocks","created_at":"2026-02-06T15:23:13.700643+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.2","depends_on_id":"stackdocs-m7b.2.1","type":"blocks","created_at":"2026-02-06T15:23:19.846497+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.3","title":"Create Sprites API client and provisioning","description":"**Goal:** Bridge can provision new Sprites from golden checkpoint and manage their lifecycle.\n**Files:** Create `bridge/src/sprites-client.ts`, `bridge/src/provisioning.ts`\n**Depends on:** Create Bridge project scaffold and WS server\n\n**Phase 0 Finding:** Services API has bug (400 in v0.0.1-rc31). Server started via `exec` WS with `max_run_after_disconnect=0` instead. API keys injected as env vars via exec command.\n\n**Steps:**\n1. Create Sprites.dev REST API client: create sprite (from checkpoint), get status, exec command, TCP proxy, checkpoints\n2. Implement lazy provisioning: when `sprite_status: pending`, create Sprite from golden checkpoint\n3. Update Supabase `stacks` row: `pending` → `provisioning` → `active` with `sprite_name`\n4. Start Python WS server via exec WS with `max_run_after_disconnect=0`, injecting API keys as env vars (`ANTHROPIC_API_KEY`, `MISTRAL_API_KEY`)\n5. Handle provisioning failures: mark as `failed`, allow retry on next connect\n6. Handle already-active sprites: just connect (server is already running — persists through sleep/wake)\n\n**Tests:**\n- [ ] Unit tests for API client methods pass (mocked HTTP responses)\n- [ ] Provisioning flow: `pending` → `provisioning` → `active` updates Supabase correctly\n- [ ] Provisioning failure: status set to `failed`, retry on next connect works\n- [ ] Already-active sprite: skips provisioning, connects directly\n- [ ] API keys injected as env vars via exec command (verified in exec params)\n- [ ] Server started via exec WS with `max_run_after_disconnect=0`","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:19:32.446236+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T10:39:49.428808+11:00","closed_at":"2026-02-07T10:39:49.428808+11:00","close_reason":"Sprites API client + provisioning implemented. 55/55 tests pass. Inspector PASS 6/6.","dependencies":[{"issue_id":"stackdocs-m7b.2.3","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:19:32.447142+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.3","depends_on_id":"stackdocs-m7b.2.2","type":"blocks","created_at":"2026-02-06T15:23:19.963401+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.4","title":"Create golden checkpoint on Sprites.dev","description":"**Goal:** Template Sprite with Python environment, packages, and directory structure ready for cloning.\n**Files:** Create `docs/ops/golden-checkpoint.md` (procedure), external Sprites.dev work\n**Depends on:** None (but needs Sprites.dev account from Phase 0)\n\n**Phase 0 Finding:** Server started via `exec` WS with `max_run_after_disconnect=0` persists through sleep/wake. Services API has bug (400) and is NOT needed for server lifecycle. Golden checkpoint should include the server code but NOT a pre-registered service.\n\n**Steps:**\n1. Create base Sprite on Sprites.dev\n2. Install Python packages: `websockets`, `aiosqlite`, `anthropic`, `claude-agent-sdk`, `mistralai`, `httpx`\n3. Create `/workspace/` directory structure: `documents/`, `ocr/`, `artifacts/`, `memory/`, `transcripts/`\n4. Initialize empty SQLite database at `/workspace/agent.db` with full schema from spec\n5. Create memory file templates: `soul.md`, `user.md`, `MEMORY.md`\n6. Deploy sprite/ source code to `/workspace/src/` on Sprite\n7. Save as golden checkpoint\n8. Document the exact procedure in `docs/ops/golden-checkpoint.md`\n9. Test: clone checkpoint, verify packages and dirs exist\n10. Document server startup strategy: Bridge starts server via `exec` WS with `max_run_after_disconnect=0` on first connect (NOT via Services API)\n\n**Tests:**\n- [ ] Clone checkpoint → `python -c \"import websockets, aiosqlite, anthropic, mistralai, httpx\"` succeeds\n- [ ] `/workspace/` dirs exist: `documents/`, `ocr/`, `artifacts/`, `memory/`, `transcripts/`\n- [ ] `/workspace/agent.db` has correct schema (all tables from spec)\n- [ ] Memory templates exist: `soul.md`, `user.md`, `MEMORY.md`\n- [ ] `/workspace/src/` contains sprite source code\n- [ ] `docs/ops/golden-checkpoint.md` documents full procedure + exec startup strategy","status":"in_progress","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:19:37.121674+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T13:14:14.316455+11:00","dependencies":[{"issue_id":"stackdocs-m7b.2.4","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:19:37.122592+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.4","depends_on_id":"stackdocs-m7b.1.1","type":"blocks","created_at":"2026-02-06T15:23:13.585179+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.5","title":"Create Sprite Python WebSocket server","description":"**Goal:** Minimal Python WebSocket server on Sprite that accepts Bridge TCP Proxy connections and routes messages.\n**Files:** Create `sprite/` directory: `requirements.txt`, `src/__init__.py`, `src/server.py`, `src/gateway.py`\n**Depends on:** Create golden checkpoint on Sprites.dev\n\n**Phase 0 Finding:** Sprites.dev freezes processes on sleep (checkpoint/CRIU, same PID on wake). Server started via `exec` WebSocket with `max_run_after_disconnect=0` persists indefinitely through sleep/wake cycles. Services API NOT needed.\n\n**Steps:**\n1. Initialize `sprite/` with Python project: `websockets`, `aiosqlite`, `anthropic`, `claude-agent-sdk`, `mistralai`, `httpx`\n2. Create `src/server.py`: WebSocket server on port 8765 using `websockets` library\n3. Create `src/gateway.py`: `SpriteGateway` class with `match/case` routing by message type\n4. Route: `mission` (async lock), `file_upload` (concurrent), `canvas_interaction` (concurrent), `heartbeat` (async lock), `system`\n5. Stub all handlers to log and echo acknowledgment\n6. Wire server to gateway: incoming messages → `gateway.route(message)`\n7. Server startup: via Sprites `exec` WS with `max_run_after_disconnect=0` (NOT Services API)\n\n**Tests:**\n- [ ] `python -m pytest sprite/tests/` passes\n- [ ] WS client connects to `ws://localhost:8765` successfully\n- [ ] Sending each message type returns echo acknowledgment\n- [ ] Unknown message type logs warning and does not crash\n- [ ] Gateway routes `mission` and `heartbeat` through async lock (verified by concurrent test)","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:19:40.765344+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T12:12:35.508918+11:00","closed_at":"2026-02-07T12:12:35.508918+11:00","close_reason":"Sprite Python WS server + gateway implemented. 11/11 tests pass. Inspector PASS 5/5. Dependency on m7b.2.4 (golden checkpoint) is for deployment, not code.","dependencies":[{"issue_id":"stackdocs-m7b.2.5","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:19:40.766294+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.5","depends_on_id":"stackdocs-m7b.2.4","type":"blocks","created_at":"2026-02-06T15:23:20.075442+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.6","title":"Bridge TCP Proxy and message forwarding","description":"**Goal:** Bridge connects to Sprite via Sprites TCP Proxy API and forwards messages bidirectionally.\n**Files:** Create `bridge/src/sprite-connection.ts`, create `bridge/src/proxy.ts`\n**Depends on:** Create Sprites API client and provisioning, Create Sprite Python WebSocket server\n\n**Steps:**\n1. Establish WebSocket connection from Bridge to Sprite via `WSS /v1/sprites/{name}/proxy` with `ProxyInitMessage` targeting port 8765\n2. Forward browser messages → Sprite (inject `request_id` if present)\n3. Forward Sprite messages → browser\n4. Handle connection lifecycle: open, close, error\n5. Track active Sprite connections per stack\n\n**Tests:**\n- [ ] Message sent from browser WS arrives at Sprite WS (integration test with real Sprite)\n- [ ] Message sent from Sprite WS arrives at browser WS\n- [ ] `request_id` injected on forwarded messages when present\n- [ ] Connection tracking correctly maps stack_id → active Sprite connection\n- [ ] Connection close on either side propagates to the other","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:19:51.679187+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T12:28:29.970596+11:00","closed_at":"2026-02-07T12:28:29.970596+11:00","close_reason":"Bridge TCP Proxy + message forwarding implemented. 65/65 tests pass. Inspector PASS. Circular dep fixed (connection-store.ts extracted).","dependencies":[{"issue_id":"stackdocs-m7b.2.6","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:19:51.680062+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.6","depends_on_id":"stackdocs-m7b.2.3","type":"blocks","created_at":"2026-02-06T15:23:20.191295+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.6","depends_on_id":"stackdocs-m7b.2.5","type":"blocks","created_at":"2026-02-06T15:23:20.312691+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.7","title":"Bridge sleep/wake reconnection and keepalive","description":"**Goal:** Bridge handles Sprite sleep/wake gracefully — reconnects TCP Proxy, buffers messages, keeps Sprites awake during active sessions.\n**Files:** Create `bridge/src/reconnect.ts`, create `bridge/src/keepalive.ts`, modify `bridge/src/proxy.ts`\n**Depends on:** Bridge TCP Proxy and message forwarding\n\n**Phase 0 Finding:** Processes survive sleep/wake (checkpoint/CRIU, same PID). The Python WS server persists — Bridge only needs to reconnect the TCP Proxy tunnel, NOT restart anything on the Sprite.\n\n**Steps:**\n1. Detect Sprite TCP Proxy connection drop (WS close/error event)\n2. Send `sprite_waking` system message to browser\n3. Call Sprites API to trigger wake (any API call wakes it), poll status until running\n4. Re-establish TCP Proxy connection to port 8765 (server is still running, same PID)\n5. Verify server responds (send ping through proxy, expect pong)\n6. If server NOT responding (crash, not sleep): send exec command to restart Python WS server\n7. Send `sprite_ready` system message to browser\n8. Replay buffered messages (max 50 messages, 60s TTL)\n9. Implement keepalive: ping Sprite every 15s during active browser sessions, stop on disconnect\n10. Handle race conditions: multiple wake attempts, messages during reconnect\n\n**Tests:**\n- [ ] Simulated connection drop → `sprite_waking` system message sent to browser\n- [ ] After reconnect → `sprite_ready` system message sent to browser\n- [ ] Buffered messages (up to 50, within 60s TTL) replayed after reconnect\n- [ ] Keepalive pings sent every 15s while browser connected (verified by timer mock)\n- [ ] Keepalive stops when browser disconnects\n- [ ] Concurrent wake attempts coalesce (no duplicate wake calls)\n- [ ] Server crash recovery: exec restart fallback works when server is unresponsive after wake","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:00.062315+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T12:52:26.116834+11:00","closed_at":"2026-02-07T12:52:26.116834+11:00","close_reason":"Closed","dependencies":[{"issue_id":"stackdocs-m7b.2.7","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:20:00.063231+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.7","depends_on_id":"stackdocs-m7b.2.6","type":"blocks","created_at":"2026-02-06T15:23:20.43094+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.8","title":"End-to-end smoke test and deployment","description":"**Goal:** Validate the full message round-trip: Browser → Bridge → Sprite → response. Deploy Bridge to Fly.io.\n**Files:** Create `bridge/tests/e2e-echo.ts` or `scripts/test-pipeline.sh`, DNS config\n**Depends on:** Bridge sleep/wake reconnection and keepalive\n\n**Steps:**\n1. Write test script: connect WS to Bridge, send auth, send mission, verify echo response\n2. Measure round-trip latency (target \u003c 500ms excluding Sprite wake)\n3. Test sleep/wake cycle: disconnect, wait 35s, reconnect, verify wake\n4. Deploy Bridge to Fly.io\n5. Configure ws.stackdocs.io DNS CNAME to Fly.io app\n6. Test from browser against production Bridge\n7. Fix any issues discovered during integration\n\n**Tests:**\n- [ ] Test script passes: connect → auth → send mission → receive echo response\n- [ ] Round-trip latency \u003c 500ms (excluding Sprite wake time)\n- [ ] Sleep/wake cycle: wait 35s → reconnect → Sprite wakes → echo works\n- [ ] Bridge accessible at wss://ws.stackdocs.io (DNS resolves, TLS works)\n- [ ] Browser-based test against production Bridge succeeds","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:05.602183+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:20:05.602183+11:00","dependencies":[{"issue_id":"stackdocs-m7b.2.8","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:20:05.602998+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.2.8","depends_on_id":"stackdocs-m7b.2.7","type":"blocks","created_at":"2026-02-06T15:23:20.548843+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.2.9","title":"Supabase schema migration for v2","description":"**Goal:** Add sprite columns to stacks table. Keep existing tables but stop writing to them.\n**Files:** Create migration SQL, modify `docs/specs/SCHEMA.md`\n**Depends on:** None (can run anytime in Phase 1)\n\n**Steps:**\n1. Add `sprite_name TEXT` and `sprite_status TEXT DEFAULT 'pending'` columns to `stacks` table\n2. Keep all existing v1 tables (don't drop — data is there, just unused)\n3. Update SCHEMA.md to document v2 platform tables (users + stacks)\n4. Test that Clerk auth + existing frontend still work (v1 and v2 coexist)\n\n**Tests:**\n- [ ] `sprite_name` and `sprite_status` columns exist on `stacks` table\n- [ ] `sprite_status` defaults to 'pending' for new rows\n- [ ] All v1 tables still exist (not dropped)\n- [ ] Existing frontend loads without errors (v1 and v2 coexist)\n- [ ] `SCHEMA.md` updated with v2 platform tables documentation","status":"closed","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:09.483676+11:00","created_by":"thebrownproject","updated_at":"2026-02-07T13:04:50.258045+11:00","closed_at":"2026-02-07T13:04:50.258045+11:00","close_reason":"Closed","dependencies":[{"issue_id":"stackdocs-m7b.2.9","depends_on_id":"stackdocs-m7b.2","type":"parent-child","created_at":"2026-02-06T15:20:09.484584+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3","title":"Phase 2: Sprite Runtime","description":"Adapt existing v1 agent code to run on Sprites with SQLite + WebSocket output. 5 tasks. Runs in PARALLEL with Phase 3.","status":"open","priority":1,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:12.761469+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:17:12.761469+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:12.762415+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3.1","title":"SQLite database layer","description":"**Goal:** Async SQLite wrapper with full schema, WAL mode, and query helpers.\n**Files:** Create `sprite/src/database.py`\n**Depends on:** Create Sprite Python WebSocket server\n\n**Steps:**\n1. Create `Database` class wrapping `aiosqlite`\n2. Initialize schema on first boot: `documents`, `ocr_results`, `extractions`, `memory_fts` tables\n3. Enable WAL mode for concurrent reads\n4. Provide `query()`, `execute()`, `fetchone()`, `fetchall()` async methods\n5. Connection pooling (single connection for MVP, serialize writes)\n\n**Tests:**\n- [ ] `python -m pytest sprite/tests/test_database.py` passes\n- [ ] Schema creates all tables on init: `documents`, `ocr_results`, `extractions`, `memory_fts`\n- [ ] `PRAGMA journal_mode` returns `wal`\n- [ ] CRUD operations work: insert, select, update, delete for each table\n- [ ] Concurrent reads don't block (WAL mode verified)\n- [ ] Database file created at expected path","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:20.518974+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:20:20.518974+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3.1","depends_on_id":"stackdocs-m7b.3","type":"parent-child","created_at":"2026-02-06T15:20:20.519891+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.3.1","depends_on_id":"stackdocs-m7b.2.5","type":"blocks","created_at":"2026-02-06T15:23:23.236814+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3.2","title":"Port tool factories from Supabase to SQLite","description":"**Goal:** All extraction agent tools work with SQLite instead of Supabase, preserving the scoped closure pattern.\n**Files:** Create `sprite/src/agents/extraction_agent/` (port from `backend/app/agents/extraction_agent/`), create `sprite/src/agents/shared/`\n**Depends on:** SQLite database layer\n\n**Steps:**\n1. Copy extraction agent structure: `agent.py`, `prompts.py`, `tools/` directory\n2. Replace `from supabase import Client` with local `Database` import in every tool\n3. Rewrite each tool's database calls: `db.table().select().eq()` → `db.query(\"SELECT ... WHERE ...\")`\n4. Port tools: `read_ocr`, `read_extraction`, `save_extraction`, `set_field`, `delete_field`, `complete`\n5. Preserve `create_tools(extraction_id, document_id, user_id, db)` factory signature (change `db` type)\n6. Port OCR service: `sprite/src/services/ocr.py` — Mistral OCR with env var API key, cache to `/workspace/ocr/`\n\n**Tests:**\n- [ ] Each tool (read_ocr, read_extraction, save_extraction, set_field, delete_field, complete) has unit test with SQLite\n- [ ] `create_tools(extraction_id, document_id, user_id, db)` returns all tools with correct signatures\n- [ ] Tools read/write SQLite correctly (verified by querying DB after tool call)\n- [ ] `save_extraction` writes JSON to `extracted_fields` column\n- [ ] OCR service caches text to `/workspace/ocr/{doc_id}.md` (file exists after call)\n- [ ] Factory closure scoping: tools only access their scoped extraction_id/document_id","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:31.423856+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:20:31.423856+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3.2","depends_on_id":"stackdocs-m7b.3","type":"parent-child","created_at":"2026-02-06T15:20:31.424641+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.3.2","depends_on_id":"stackdocs-m7b.3.1","type":"blocks","created_at":"2026-02-06T15:23:23.358846+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3.3","title":"Agent runtime with WebSocket output","description":"**Goal:** Claude Agent SDK runs on Sprite and streams events as WebSocket messages instead of SSE.\n**Files:** Create `sprite/src/runtime.py`, modify `sprite/src/gateway.py`\n**Depends on:** Port tool factories from Supabase to SQLite\n\n**Steps:**\n1. Create `AgentRuntime` class wrapping Claude Agent SDK (ClaudeSDKClient, ClaudeAgentOptions)\n2. Map SDK event stream to `agent_event` WebSocket messages: text, tool, complete, error\n3. Register extraction tools via MCP server with allowed_tools whitelist\n4. Support session resume via ClaudeAgentOptions(resume=session_id)\n5. Wire into SpriteGateway.handle_mission(): load memory → build system prompt → invoke agent → stream events\n6. Serialize missions with async lock (one at a time)\n\n**Note:** Pre-compaction memory flush requires the raw anthropic SDK — claude-agent-sdk does not expose compaction controls. This is explicitly post-MVP.\n\n**Tests:**\n- [ ] Agent invocation streams agent_event messages over WS (mock WS captures text, tool, complete events)\n- [ ] Event type mapping: SDK events → correct event_type values (text, tool, complete, error)\n- [ ] mission_lock prevents concurrent missions (second mission waits until first completes)\n- [ ] Session resume: ClaudeAgentOptions(resume=session_id) restores previous conversation\n- [ ] Extraction tools registered and callable by agent via MCP server\n- [ ] Error in agent → agent_event with event_type: 'error' sent to browser","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:41.720708+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:20:41.720708+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3.3","depends_on_id":"stackdocs-m7b.3","type":"parent-child","created_at":"2026-02-06T15:20:41.721638+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.3.3","depends_on_id":"stackdocs-m7b.3.2","type":"blocks","created_at":"2026-02-06T15:23:23.477671+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3.4","title":"Canvas tools for agent","description":"**Goal:** Agent can create/update/close cards on the user's Canvas via custom tools, composing from the block catalog.\n**Files:** Create `sprite/src/agents/shared/canvas_tools.py`\n**Depends on:** Agent runtime with WebSocket output\n\n**Steps:**\n1. Create tool factory: `create_canvas_tools(ws_send_fn)` — scoped with WebSocket send function\n2. `create_card(title, blocks)` → sends `canvas_update` message with `command: 'create_card'` and block array\n3. `update_card(card_id, blocks)` → sends `canvas_update` with `command: 'update_card'` and changed blocks (matched by block `id`)\n4. `close_card(card_id)` → sends `canvas_update` with `command: 'close_card'`\n5. Register as Claude Agent SDK tools alongside extraction tools\n6. Agent composes cards from MVP block types: `heading`, `stat`, `key-value`, `table`, `badge`, `progress`, `text`, `separator`\n\n**Tests:**\n- [ ] `create_card(\"Test\", [heading_block, table_block])` sends `canvas_update` with `command: 'create_card'` and blocks array over WS\n- [ ] `update_card(card_id, [updated_block])` sends `canvas_update` with `command: 'update_card'` and changed blocks\n- [ ] `close_card(card_id)` sends `canvas_update` with `command: 'close_card'`\n- [ ] All three tools registered alongside extraction tools in agent's tool list\n- [ ] Message payloads match protocol schema (card_id, title, blocks fields present)\n- [ ] Blocks validated: each has `id` and `type` matching MVP catalog","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:48.40387+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:12:42.374511+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3.4","depends_on_id":"stackdocs-m7b.3","type":"parent-child","created_at":"2026-02-06T15:20:48.404809+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.3.4","depends_on_id":"stackdocs-m7b.3.3","type":"blocks","created_at":"2026-02-06T15:23:23.601206+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.3.5","title":"Basic memory system (file loading + journals)","description":"**Goal:** Memory files load into agent system prompt at session start. Daily journals capture activity.\n**Files:** Create `sprite/src/memory/` directory: `init.py`, `loader.py`, `journal.py`, `transcript.py`\n**Depends on:** Agent runtime with WebSocket output\n\n**Steps:**\n1. init.py: On first boot, create memory templates: soul.md, user.md, MEMORY.md in /workspace/memory/\n2. loader.py: Load soul.md + user.md + MEMORY.md + today's journal + yesterday's journal → structured system prompt section\n3. journal.py: After each mission, append summary to /workspace/memory/YYYY-MM-DD.md\n4. transcript.py: Log every tool call + agent response to /workspace/transcripts/YYYY-MM-DDTHH-MM-SS.jsonl\n5. Create agent tools: write_memory, update_soul, update_user_prefs in sprite/src/agents/shared/memory_tools.py\n\n**Tests:**\n- [ ] First boot creates soul.md, user.md, MEMORY.md in /workspace/memory/ if missing\n- [ ] Second boot skips creation (files already exist, not overwritten)\n- [ ] Loader returns structured string containing content from all 5 sources (soul + user + MEMORY + today + yesterday)\n- [ ] Journal appends to /workspace/memory/YYYY-MM-DD.md (correct date, append not overwrite)\n- [ ] Transcript logs to /workspace/transcripts/YYYY-MM-DDTHH-MM-SS.jsonl with valid JSON lines\n- [ ] Memory tools (write_memory, update_soul, update_user_prefs) write to correct files","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:20:56.723308+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:20:56.723308+11:00","dependencies":[{"issue_id":"stackdocs-m7b.3.5","depends_on_id":"stackdocs-m7b.3","type":"parent-child","created_at":"2026-02-06T15:20:56.724247+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.3.5","depends_on_id":"stackdocs-m7b.3.3","type":"blocks","created_at":"2026-02-06T15:23:23.71991+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4","title":"Phase 3: Canvas UI — Composable Card System","description":"React Flow infinite canvas with composable card system (A2UI-inspired, custom block catalog). Agent streams cards composed from block primitives (heading, stat, key-value, table, badge, progress, text, separator). 7 active tasks + 1 deferred. Runs in PARALLEL with Phase 2. Does NOT need a live Sprite — build against mock data.","status":"open","priority":1,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:13.208677+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:10:51.716977+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:13.209437+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.1","title":"WebSocket connection manager and store","description":"**Goal:** Frontend connects to Bridge via WebSocket with Clerk auth, dispatches messages, and tracks connection state.\n**Files:** Create `frontend/lib/websocket.ts`, create `frontend/lib/stores/ws-store.ts`\n**Depends on:** Define WebSocket message protocol, Create Bridge project scaffold and WS server\n\n**Steps:**\n1. websocket.ts: WebSocket client connecting to wss://ws.stackdocs.io/{stack_id}\n2. Send Clerk JWT as first message, handle auth response\n3. Exponential backoff reconnection (1s, 2s, 4s, max 30s)\n4. Message dispatch to registered handlers by type\n5. ws-store.ts: Zustand store exposing connectionStatus, sendMessage(), lastError\n6. Listen for system messages to update connection status\n7. Integrate with Clerk useAuth() for JWT\n\n**Tests:**\n- [ ] Connects to WS URL and sends auth message as first frame\n- [ ] Reconnects with exponential backoff (1s, 2s, 4s, max 30s) on disconnect\n- [ ] Message handlers dispatched by type field\n- [ ] Zustand store connectionStatus updates on system messages\n- [ ] sendMessage() serializes and sends over WS connection\n- [ ] `npm run build` passes with no TypeScript errors in new files","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:09.069787+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:21:09.069787+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.1","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:09.0713+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.1","depends_on_id":"stackdocs-m7b.2.1","type":"blocks","created_at":"2026-02-06T15:23:26.555204+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.1","depends_on_id":"stackdocs-m7b.2.2","type":"blocks","created_at":"2026-02-06T15:23:26.667909+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.2","title":"React Flow canvas and base card component","description":"**Goal:** Infinite canvas with pan/zoom/grid that renders draggable, resizable card nodes with a block renderer.\n**Files:** Create `frontend/components/canvas/stack-canvas.tsx`, create `frontend/components/canvas/canvas-card.tsx`, create `frontend/components/canvas/card-renderer.tsx`\n**Depends on:** None (can use mock data)\n\n**Steps:**\n1. Install `@xyflow/react`\n2. `stack-canvas.tsx`: React Flow wrapper with pan, zoom, grid background, snap-to-grid\n3. `canvas-card.tsx`: Custom React Flow node — title bar (drag handle, title text, close button), resizable body, renders blocks via card-renderer\n4. `card-renderer.tsx`: Takes a `blocks: Block[]` array, renders each block top-to-bottom using the appropriate block component. Unknown block types render a fallback.\n5. Use shadcn/ui Card for card container styling consistency\n6. Register as custom node type in React Flow\n\n**Tests:**\n- [ ] `StackCanvas` renders without crash (smoke test)\n- [ ] Pan, zoom, and grid background visible in rendered output\n- [ ] `CanvasCard` renders with title bar (title text, close button)\n- [ ] Card is draggable (React Flow node drag)\n- [ ] Card is resizable (resize handle works)\n- [ ] `CardRenderer` renders blocks array top-to-bottom (order preserved)\n- [ ] Unknown block type renders graceful fallback (not crash)\n- [ ] `npm run build` passes with no TypeScript errors","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:16.897039+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:10:58.195314+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.2","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:16.898176+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.3","title":"MVP block components","description":"**Goal:** Build the 8 data-focused block components that compose into cards on the Canvas.\n**Files:** Create `frontend/components/canvas/blocks/` directory: `heading-block.tsx`, `stat-block.tsx`, `key-value-block.tsx`, `table-block.tsx`, `badge-block.tsx`, `progress-block.tsx`, `text-block.tsx`, `separator-block.tsx`\n**Depends on:** React Flow canvas and base card component\n\n**Steps:**\n1. `heading-block.tsx`: Title text + optional subtitle. Uses Card Header pattern.\n2. `stat-block.tsx`: Large value + muted label + optional trend. Custom layout.\n3. `key-value-block.tsx`: Grid of label:value pairs. Clean two-column layout.\n4. `table-block.tsx`: TanStack Table with columns + rows props. Editable cells send `canvas_interaction` with `card_id` + `block_id`. Reuse patterns from `stacks/stack-table-view.tsx`.\n5. `badge-block.tsx`: shadcn Badge with variant (default, success, warning, destructive).\n6. `progress-block.tsx`: shadcn Progress bar with value + optional label.\n7. `text-block.tsx`: Markdown rendering via `react-markdown` (already in project).\n8. `separator-block.tsx`: shadcn Separator.\n\n**Tests:**\n- [ ] Each of 8 block components renders without crash (smoke tests)\n- [ ] `table-block` renders columns and rows from props (headers visible, data in cells)\n- [ ] `table-block` cell edit triggers `canvas_interaction` with correct `card_id`, `block_id`, and `action: 'edit_cell'`\n- [ ] `stat-block` displays value prominently with muted label\n- [ ] `key-value-block` renders label:value pairs in grid layout\n- [ ] `badge-block` renders correct variant styling (success = green, destructive = red, etc.)\n- [ ] `text-block` renders markdown (headings, bold, lists)\n- [ ] Empty/missing props handled gracefully (no crashes)\n- [ ] `npm run build` passes with no TypeScript errors","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:22.186352+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:05.321881+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.3","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:22.187333+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.3","depends_on_id":"stackdocs-m7b.4.2","type":"blocks","created_at":"2026-02-06T15:23:26.784139+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.4","title":"Document and notes window components","description":"**Goal:** Supporting window types for PDF preview and markdown notes on Canvas.\n**Files:** Create `frontend/components/canvas/windows/document-window.tsx`, `notes-window.tsx`\n**Depends on:** React Flow canvas and base window component\n\n**Steps:**\n1. document-window.tsx: PDF preview via react-pdf (already in project) or image via img. Page navigation for multi-page PDFs.\n2. notes-window.tsx: Markdown display using react-markdown (already in project). Agent writes content, user views.\n\n**Tests:**\n- [ ] document-window.tsx renders a PDF page (given test PDF data or mock)\n- [ ] Document window shows page navigation for multi-page PDFs\n- [ ] notes-window.tsx renders markdown string (headings, lists, bold render correctly)\n- [ ] Both components accept props and render inside CanvasWindow wrapper\n- [ ] `npm run build` passes with no TypeScript errors","status":"closed","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:27.185902+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:13.805712+11:00","closed_at":"2026-02-06T16:11:13.805712+11:00","close_reason":"Deferred: Notes functionality covered by text-block (markdown). PDF viewer deferred to post-MVP — will be added as a document block type later. Replaced by composable card system with block catalog.","dependencies":[{"issue_id":"stackdocs-m7b.4.4","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:27.186838+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.4","depends_on_id":"stackdocs-m7b.4.2","type":"blocks","created_at":"2026-02-06T15:23:26.900414+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.5","title":"Canvas Zustand store with WS integration","description":"**Goal:** Centralized state for all canvas cards with localStorage persistence and WebSocket message handling.\n**Files:** Create `frontend/lib/stores/canvas-store.ts`\n**Depends on:** React Flow canvas and base card component, WebSocket connection manager and store\n\n**Steps:**\n1. Zustand store: `cards` Map (card_id → { title, blocks: Block[], position, size }), `activeCardId`\n2. Actions: `addCard()`, `updateCard()`, `removeCard()`, `updateBlocks()`, `updatePosition()`, `updateSize()`\n3. Persist to localStorage via Zustand persist middleware\n4. Subscribe to `canvas_update` WebSocket messages → `create_card` calls `addCard()`, `update_card` calls `updateCard()` (merge changed blocks by ID), `close_card` calls `removeCard()`\n5. User interactions (close, resize, move) update store locally + send `canvas_interaction` messages with `card_id` and optional `block_id`\n\n**Tests:**\n- [ ] `addCard()` adds card to store, `removeCard()` removes it, `updateCard()` updates blocks\n- [ ] Store persists to localStorage (reload → cards restored from storage)\n- [ ] `canvas_update` WS message with `create_card` → `addCard()` called, card appears in store\n- [ ] `canvas_update` WS message with `update_card` → card blocks updated in store (matched by block ID)\n- [ ] `canvas_update` WS message with `close_card` → card removed from store\n- [ ] User close/resize/move → `canvas_interaction` message sent over WS with `card_id`","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:38.056031+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:20.010938+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.5","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:38.057104+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.5","depends_on_id":"stackdocs-m7b.4.2","type":"blocks","created_at":"2026-02-06T15:23:27.017696+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.5","depends_on_id":"stackdocs-m7b.4.1","type":"blocks","created_at":"2026-02-06T15:23:27.139821+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.6","title":"Subbar, chat bar, and status indicator","description":"**Goal:** Card manager taskbar, chat input for missions, and connection status display.\n**Files:** Modify `frontend/app/(app)/stacks/[id]/@subbar/page.tsx`, create `frontend/components/canvas/chat-bar.tsx`, create `frontend/components/canvas/connection-status.tsx`\n**Depends on:** Canvas Zustand store with WS integration\n\n**Steps:**\n1. Subbar: Replace current tab navigation with dynamic card tabs from canvas store. Click to focus/pan, X to close. Card title as tab label.\n2. Chat bar: Text input + send button at bottom of Canvas. Sends `mission` messages over WebSocket. File upload button (paperclip icon) for alternative to drag-and-drop. Adapt patterns from existing `agent-container.tsx`.\n3. Connection status: Connecting, Sprite waking (spinner), Connected (green dot), Disconnected (red dot). Read from WS store connectionStatus. Display in header or Canvas top-right.\n4. Agent event rendering: Display `agent_event` messages in chat panel — streaming text, tool indicators, errors. Reuse existing agent card/content components.\n\n**Tests:**\n- [ ] Subbar renders one tab per open card (matches canvas store state)\n- [ ] Click tab → canvas pans to focus on that card\n- [ ] X on tab → card closes (removed from store)\n- [ ] Chat bar sends `mission` message on submit (message captured by mock WS)\n- [ ] Connection status shows correct indicator for each state\n- [ ] Agent events render in chat panel (text streams, tool calls shown, errors displayed)\n- [ ] `npm run build` passes with no TypeScript errors","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:46.951863+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:26.037335+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.6","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:46.952735+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.6","depends_on_id":"stackdocs-m7b.4.5","type":"blocks","created_at":"2026-02-06T15:23:27.256658+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.7","title":"Stack page rewrite for Canvas layout","description":"**Goal:** Replace tab-based stack detail view with Canvas + chat layout.\n**Files:** Modify `frontend/app/(app)/stacks/[id]/page.tsx`, modify `frontend/components/stacks/stack-detail-client.tsx`\n**Depends on:** Subbar, chat bar, and status indicator\n\n**Steps:**\n1. Replace `StackDetailClient` tabs UI with `StackCanvas` component\n2. Initialize WS connection when stack page loads (via WS store)\n3. Chat bar at bottom, subbar shows card tabs\n4. Canvas takes full viewport minus header/subbar/chat\n5. Disconnect WS when navigating away from stack page\n6. Preserve existing stack list page (unchanged)\n\n**Tests:**\n- [ ] Stack detail page renders `StackCanvas` (not the old tabs UI)\n- [ ] WS connection established on page load (connection status shows connecting → connected)\n- [ ] WS disconnected on navigate away (verified by store status)\n- [ ] Canvas fills viewport minus header/subbar/chat (no overflow, no scroll)\n- [ ] Stack list page (`/stacks`) unchanged and still functional\n- [ ] `npm run build` passes with no TypeScript errors","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:53.770286+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:31.744352+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.7","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:53.771114+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.7","depends_on_id":"stackdocs-m7b.4.6","type":"blocks","created_at":"2026-02-06T15:23:27.371043+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.4.8","title":"CSV and JSON export from table blocks","description":"**Goal:** Download extraction data as CSV or JSON directly from Canvas cards containing table blocks.\n**Files:** Modify `frontend/components/canvas/blocks/table-block.tsx` or `frontend/components/canvas/canvas-card.tsx`\n**Depends on:** MVP block components\n\n**Steps:**\n1. Add Export dropdown in card header (when card contains a table block): CSV, JSON options\n2. CSV: Serialize table data (headers as first row, values as subsequent rows), trigger browser download\n3. JSON: Serialize as array of objects, trigger browser download\n4. No server round-trip — data is already in Canvas store\n\n**Tests:**\n- [ ] Export dropdown visible in card header (when table block present) with CSV and JSON options\n- [ ] CSV download contains headers as first row, values as subsequent rows\n- [ ] JSON download contains array of objects (keys = column names)\n- [ ] Downloaded file has correct filename\n- [ ] No network request made during export (client-side only)","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:21:58.93884+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:11:36.778247+11:00","dependencies":[{"issue_id":"stackdocs-m7b.4.8","depends_on_id":"stackdocs-m7b.4","type":"parent-child","created_at":"2026-02-06T15:21:58.93972+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.4.8","depends_on_id":"stackdocs-m7b.4.3","type":"blocks","created_at":"2026-02-06T15:23:27.493475+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.5","title":"Phase 4: Upload + Extraction","description":"Wire everything together into the MVP demo flow. 4 tasks. Starts after Phase 2+3 integration gate.","status":"open","priority":1,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:13.686969+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:17:13.686969+11:00","dependencies":[{"issue_id":"stackdocs-m7b.5","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:13.687693+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.5.1","title":"File upload pipeline (frontend + Sprite)","description":"**Goal:** Drag-and-drop file onto Canvas → base64 encode → WebSocket → Sprite → save to disk → SQLite record.\n**Files:** Modify `frontend/components/canvas/stack-canvas.tsx` (drop handler), create `sprite/src/handlers/upload.py`\n**Depends on:** Canvas Zustand store with WS integration, SpriteGateway (from Phase 2)\n\n**Steps:**\n1. Frontend: Enable drag-and-drop on Canvas. Read file as base64, send `file_upload` message. Show optimistic processing card with badge block.\n2. Frontend: Upload button (paperclip) in chat bar as alternative. Support PDF, PNG, JPG, JPEG. 25MB max.\n3. Sprite: `handle_upload()` decodes base64, writes to `/workspace/documents/{uuid}_{filename}`\n4. Sprite: Create `documents` row in SQLite with `status: 'processing'`\n5. Sprite: Send `status` message back to browser\n6. Sprite: Trigger OCR as background asyncio task\n\n**Tests:**\n- [ ] Drag file onto Canvas → `file_upload` message sent over WS (captured by mock)\n- [ ] Paperclip button click → file picker opens, selected file sent as `file_upload`\n- [ ] Files \u003e 25MB rejected on frontend with error message\n- [ ] Sprite receives upload → file written to `/workspace/documents/{uuid}_{filename}`\n- [ ] SQLite `documents` row created with `status: 'processing'`\n- [ ] `status` message sent back to browser with `status: 'processing'`\n- [ ] Unsupported file types rejected (only PDF, PNG, JPG, JPEG accepted)","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:13.063247+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:12:52.494979+11:00","dependencies":[{"issue_id":"stackdocs-m7b.5.1","depends_on_id":"stackdocs-m7b.5","type":"parent-child","created_at":"2026-02-06T15:22:13.064297+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.5.1","depends_on_id":"stackdocs-m7b.4.5","type":"blocks","created_at":"2026-02-06T15:23:29.801748+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.5.1","depends_on_id":"stackdocs-m7b.3.3","type":"blocks","created_at":"2026-02-06T15:23:29.916707+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.5.2","title":"OCR and extraction agent integration","description":"**Goal:** Uploaded documents get OCR'd and extracted, with results streaming to Canvas as cards with table blocks.\n**Files:** Modify `sprite/src/services/ocr.py`, modify `sprite/src/handlers/upload.py`, wire `sprite/src/agents/extraction_agent/`\n**Depends on:** File upload pipeline, Agent runtime with WebSocket output\n\n**Steps:**\n1. OCR: Mistral OCR API call (env var key) → cache text to `/workspace/ocr/{doc_id}.md`. Also support Claude native PDF (pass base64 directly in extraction prompt). Agent decides which method per document.\n2. After OCR: Send `canvas_update` to create processing card on Canvas (heading + badge block)\n3. Run extraction agent: pass OCR text, agent calls tools to extract structured data\n4. Agent calls `create_card` tool → extraction card appears on Canvas with stat + table blocks showing extracted fields\n5. Update SQLite: extraction record with fields, document status to `completed`\n6. Update daily journal with extraction summary\n\n**Tests:**\n- [ ] OCR produces cached text at `/workspace/ocr/{doc_id}.md` (file exists, non-empty)\n- [ ] Processing card created on Canvas after OCR completes (canvas_update message sent)\n- [ ] Extraction agent runs and creates extraction card with table block showing extracted fields\n- [ ] SQLite `extractions` row created with `extracted_fields` JSON\n- [ ] Document `status` updated to `completed` in SQLite\n- [ ] Daily journal updated with extraction summary line\n- [ ] Both Mistral OCR and Claude native PDF paths work (tested separately)","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:22.07515+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:13:09.848702+11:00","dependencies":[{"issue_id":"stackdocs-m7b.5.2","depends_on_id":"stackdocs-m7b.5","type":"parent-child","created_at":"2026-02-06T15:22:22.076082+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.5.2","depends_on_id":"stackdocs-m7b.5.1","type":"blocks","created_at":"2026-02-06T15:23:30.033598+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.5.2","depends_on_id":"stackdocs-m7b.3.3","type":"blocks","created_at":"2026-02-06T15:23:30.150704+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.5.3","title":"Correction flow and Canvas state awareness","description":"**Goal:** User can correct extractions via chat. Agent receives Canvas state to know what the user sees.\n**Files:** Modify `sprite/src/gateway.py`, modify `frontend/lib/stores/canvas-store.ts`\n**Depends on:** OCR and extraction agent integration\n\n**Steps:**\n1. Canvas state injection: When mission is sent, include current Canvas state (open cards, active table block data) in context\n2. Frontend serializes Canvas state from store, sends as part of mission or at session start\n3. Agent receives corrections via chat: \"the vendor should be Acme Corp\"\n4. Agent calls `set_field` to update SQLite + `update_card` to refresh table block on Canvas\n5. Agent updates `soul.md` if correction reveals a pattern (prompt engineering)\n\n**Tests:**\n- [ ] Mission message includes serialized Canvas state (open cards, active table block data)\n- [ ] Chat \"change vendor to Acme Corp\" → `set_field` updates SQLite extraction record\n- [ ] `update_card` message sent → table block refreshes on Canvas with corrected data\n- [ ] After 3+ corrections on same field pattern → `soul.md` updated with learned rule\n- [ ] Canvas state serialization includes card_id, title, and blocks for each open card","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:29.69155+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T16:13:18.176784+11:00","dependencies":[{"issue_id":"stackdocs-m7b.5.3","depends_on_id":"stackdocs-m7b.5","type":"parent-child","created_at":"2026-02-06T15:22:29.692365+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.5.3","depends_on_id":"stackdocs-m7b.5.2","type":"blocks","created_at":"2026-02-06T15:23:30.266186+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.6","title":"Phase 5: Memory + Polish","description":"Complete the memory system and polish the MVP demo. 3 tasks.","status":"open","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:17:14.138689+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:17:14.138689+11:00","dependencies":[{"issue_id":"stackdocs-m7b.6","depends_on_id":"stackdocs-m7b","type":"parent-child","created_at":"2026-02-06T15:17:14.139555+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.6.1","title":"FTS5 memory search","description":"**Goal:** Agent can search past memories using hybrid BM25 text search.\n**Files:** Create `sprite/src/memory/index.py`, modify `sprite/src/agents/shared/memory_tools.py`\n**Depends on:** Basic memory system (file loading + journals)\n\n**Steps:**\n1. Implement memory_fts virtual table indexing: on startup and after memory writes, chunk memory files (sliding window, ~512 tokens per chunk) and insert into FTS5\n2. Provide search_memory(query) function returning ranked BM25 results\n3. Create agent tool: search_memories(query) → returns relevant past context\n4. BM25 only for MVP (skip vector embeddings — add post-MVP)\n\n**Tests:**\n- [ ] memory_fts table populated on startup (row count \u003e 0 after indexing existing memory files)\n- [ ] search_memory(\"invoice\") returns relevant chunks ranked by BM25 score\n- [ ] Agent tool search_memories is callable and returns formatted results\n- [ ] Re-indexes after memory writes (write to journal → new content searchable)\n- [ ] Empty memory files → graceful handling (no crash, empty results)","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:42.608405+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:22:42.608405+11:00","dependencies":[{"issue_id":"stackdocs-m7b.6.1","depends_on_id":"stackdocs-m7b.6","type":"parent-child","created_at":"2026-02-06T15:22:42.60965+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.6.1","depends_on_id":"stackdocs-m7b.3.5","type":"blocks","created_at":"2026-02-06T15:23:32.969361+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.6.2","title":"Session persistence and reconnection verification","description":"**Goal:** Verify the full persistence story: upload → extract → close browser → Sprite sleeps → reopen → everything intact.\n**Files:** Integration test + frontend/ reconnection improvements\n**Depends on:** OCR and extraction agent integration\n\n**Steps:**\n1. Test full cycle: upload docs, extract data, close browser, wait for Sprite sleep (35s), reopen browser\n2. Verify: Canvas loads from localStorage, agent loads memory, SQLite has all data\n3. Frontend: On reconnect, load Canvas state from localStorage + request Sprite state sync if needed\n4. Fix any gaps discovered during testing\n\n**Tests:**\n- [ ] Full cycle passes: upload → extract → close browser → wait 35s → reopen → Canvas loads\n- [ ] Canvas state restored from localStorage (same windows, positions, data)\n- [ ] Agent memory intact: soul.md, journals, MEMORY.md all present on Sprite after wake\n- [ ] SQLite data intact: documents, extractions, OCR results all queryable after wake\n- [ ] No data loss or corruption after sleep/wake cycle","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:49.430367+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:22:49.430367+11:00","dependencies":[{"issue_id":"stackdocs-m7b.6.2","depends_on_id":"stackdocs-m7b.6","type":"parent-child","created_at":"2026-02-06T15:22:49.431266+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.6.2","depends_on_id":"stackdocs-m7b.5.2","type":"blocks","created_at":"2026-02-06T15:23:33.090661+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-m7b.6.3","title":"Demo polish and error handling","description":"**Goal:** Polish loading states, error handling, and prepare the MVP demo script.\n**Files:** Various Canvas components, Bridge error handling, create `docs/demo/mvp-demo-script.md`\n**Depends on:** Session persistence and reconnection verification\n\n**Steps:**\n1. Loading states: Sprite waking animation (skeleton canvas), file upload progress, extraction in-progress (shimmer rows), agent thinking (typing dots)\n2. Error handling: WS disconnect mid-extraction (buffer + resume), upload failure (retry), agent error (show in chat + retry), provisioning failure (error state + retry)\n3. Clerk webhook for session revocation (deferred from Phase 1): Bridge receives webhook, force-disconnects revoked sessions\n4. Write demo script: login → Sprite wakes → upload 3 invoices → extract all vendor data → correct a field → close/reopen → CSV export\n\n**Tests:**\n- [ ] Loading states visible: skeleton canvas (Sprite waking), shimmer rows (extraction), typing dots (agent thinking)\n- [ ] Upload failure → error message + retry button shown\n- [ ] WS disconnect mid-session → error indicator + automatic reconnection attempt\n- [ ] Agent error → error shown in chat + retry option\n- [ ] Clerk webhook → Bridge force-disconnects revoked session\n- [ ] docs/demo/mvp-demo-script.md exists with complete demo flow\n- [ ] Full demo flow completes end-to-end without manual intervention (except user chat inputs)","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-06T15:22:58.656981+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:22:58.656981+11:00","dependencies":[{"issue_id":"stackdocs-m7b.6.3","depends_on_id":"stackdocs-m7b.6","type":"parent-child","created_at":"2026-02-06T15:22:58.657917+11:00","created_by":"thebrownproject"},{"issue_id":"stackdocs-m7b.6.3","depends_on_id":"stackdocs-m7b.6.2","type":"blocks","created_at":"2026-02-06T15:23:33.211666+11:00","created_by":"thebrownproject"}]}
{"id":"stackdocs-qdr","title":"Sign-in page flashes briefly after login","description":"[Migrated from ACTIVE.md #4]\n\nSign-in page flashes briefly after login before redirecting to /documents.\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:06:55.86518+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"stackdocs-s1j","title":"OCR images not rendering in Visual preview","description":"[Migrated from ACTIVE.md #6]\n\nMistral OCR extracts images as ![img-0.jpeg](img-0.jpeg) but we don't store/serve them.\n\nOptions:\n- Store extracted images to Supabase Storage during OCR\n- Or strip/hide image markdown\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:06:59.033904+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-sov","title":"Assign document to stacks from document detail page","description":"[Migrated from ACTIVE.md #30]\n\nDropdown in sub-bar to add/remove document from stacks, needs to handle re-extraction when stack membership changes.\n\nDate: 2025-12-30","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:59.886765+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-z2j","title":"Support JPG/PNG image uploads","description":"[Migrated from ACTIVE.md #14]\n\nMistral OCR already handles images, just need to update accepted file types in upload dialog.\n\nDate: 2025-12-24","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:07:43.833015+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-z3t","title":"Sidebar gradual collapse to icon-only mode","description":"[Migrated from ACTIVE.md #32]\n\nIcon-only mode at tablet breakpoint (768-1024px) instead of hard switch to mobile sheet.\n\nCurrently: Single breakpoint at 1024px switches directly to mobile sheet overlay\nGoal: Desktop (\u003e=1024px) full sidebar, Tablet (768-1024px) icon-only locked, Mobile (\u003c768px) sheet\nBehavior: Icon-only mode locked (no expand), desktop state remembered when resizing back\nChanges: Update use-mobile.ts to three-state, modify SidebarProvider and Sidebar component\nReference: Linear collapses sidebar at ~1024px with similar pattern\n\nDate: 2025-12-31","status":"tombstone","priority":2,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:08:35.704286+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"stackdocs-zvl","title":"Clerk production OAuth missing client_id","description":"[Migrated from ACTIVE.md #3]\n\nGoogle, Microsoft fail; Apple removed.\n\nSetup instructions:\n- Google: Cloud Console → APIs \u0026 Credentials → Create OAuth 2.0 Client ID → Add to Clerk\n- Microsoft: Azure Portal → App Registrations → Create app → Add to Clerk\n- Clerk docs: https://clerk.com/docs/authentication/social-connections/google\n\nDate: 2025-12-23","status":"tombstone","priority":2,"issue_type":"bug","owner":"fraserbrown@live.com","created_at":"2026-01-25T10:06:54.33104+11:00","created_by":"thebrownproject","updated_at":"2026-02-06T15:01:11.878859+11:00","deleted_at":"2026-02-06T15:01:11.878859+11:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
