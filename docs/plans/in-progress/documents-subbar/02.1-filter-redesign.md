# Filter Redesign Plan (02.1)

## Summary

Redesign the filter dropdown to use sub-menus and display active filters as pills in the sub-bar.

## Current State (Phase 2 Complete)

- Filter dropdown with flat structure (date radio group + status checkboxes)
- `activeFilterCount` shown in button label
- Context: `dateRange`, `statusFilter`, `clearFilters()`
- Table filtering via `useMemo` in `documents-table.tsx`

## New Design Requirements

### 1. Sub-Menu Structure (like Theme menu)

```
Filter (dropdown)
├── Date (icon: Calendar) → [sub-menu]
│   ├── All time
│   ├── Today
│   ├── Yesterday
│   ├── Last 7 days
│   └── Last 30 days
│
└── Stacks (icon: Folder) → [sub-menu]
    ├── [Stack 1] (checkbox)
    ├── [Stack 2] (checkbox)
    └── [Stack N] (checkbox)
```

**Pattern Reference**: `sidebar-header-menu.tsx` lines 70-93 (Theme sub-menu)

Uses: `DropdownMenuSub`, `DropdownMenuSubTrigger`, `DropdownMenuSubContent`

### 2. Active Filter Pills in Sub-Bar (Linear-style)

Layout when filters active:
```
[Calendar] 7 days [X]  [Folder] Receipts Q4 [X]  [Folder] Invoices [X]  [≡ Filter icon]
```

- **Pills on left**, filter icon-only button pushed to **right**
- Each filter = individual pill (including each selected stack)
- Short labels: "7 days" not "Last 7 days", "Today" stays "Today"
- Pill structure: `[icon] [value] [X]`
- X removes that specific filter
- Filter button loses text label, becomes icon-only when any filter active

Layout when no filters:
```
[≡ Filter]  (text label visible)
```

### 3. Filter Changes

| Remove | Add |
|--------|-----|
| Status filter (completed, processing, etc.) | Stacks filter (multi-select) |

## Files to Modify

| File | Changes |
|------|---------|
| `filter-button.tsx` | Sub-menu structure, remove status, add stacks |
| `documents-filter-context.tsx` | Remove `statusFilter`, add `stackFilter: Set<string>` |
| `documents-table.tsx` | Update filtering logic for stacks |
| **NEW**: `filter-pill.tsx` | Active filter pill component |
| **NEW**: `filter-bar.tsx` | Filter bar (pills + button) |
| `sub-bar.tsx` or parent | Render filter bar |

## Dependencies

- Need `getAllStacks` query (will pull from Phase 3, Task 6)
- Need stacks data passed to FilterButton

## Implementation Tasks

### Task 2.1.1: Update filter context
- Remove `statusFilter`, `toggleStatusFilter`, `setStatusFilter`
- Add `stackFilter: Set<string>` (stack IDs)
- Add `toggleStackFilter(stackId: string)`
- Update `activeFilterCount` calculation
- Add `clearDateFilter()` and `clearStackFilter(stackId)` for individual clears

### Task 2.1.2: Create filter pill component
- New file: `frontend/components/layout/filter-pill.tsx`
- Props: `icon`, `label`, `onRemove`
- Styling: match Linear pills (border, rounded, X button)

### Task 2.1.3: Add getAllStacks query
- Pull from Phase 3, Task 6: `frontend/lib/queries/stacks.ts`
- Export `getAllStacks()` function

### Task 2.1.4: Redesign filter dropdown with sub-menus
- Modify: `frontend/components/layout/filter-button.tsx`
- Add `DropdownMenuSub` for Date (with short labels)
- Add `DropdownMenuSub` for Stacks (checkboxes, needs stacks prop)
- Remove status section
- Icon-only when filters active

### Task 2.1.5: Create filter bar component
- New file: `frontend/components/layout/filter-bar.tsx`
- Renders: pills + filter button in flex container
- Handles layout: pills left, button right

### Task 2.1.6: Update documents table filtering
- Modify: `frontend/components/documents/documents-table.tsx`
- Replace `statusFilter` logic with `stackFilter` logic
- Filter by `stack_documents` relationship

### Task 2.1.7: Wire up in sub-bar
- Pass stacks data to filter components
- Integrate filter-bar into sub-bar layout

### Task 2.1.8: Filter-aware empty state
- Modify: `frontend/components/documents/documents-table.tsx` (or empty state component)
- When `filteredDocuments.length === 0` AND `documents.length > 0`:
  - Show "No documents match your filters" (not "No documents yet")
  - Add "Clear filters" button that calls `clearFilters()`
- Keep original empty state only when `documents.length === 0`

## Date Label Mapping

| Value | Pill Label |
|-------|------------|
| today | Today |
| yesterday | Yesterday |
| last7 | 7 days |
| last30 | 30 days |
